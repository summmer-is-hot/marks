## <font color=SlateBlue>å‰ç«¯æ‰‹å†™ä»£ç é¢˜ï¼ˆä¸‰ï¼‰</font>

## 21. æ‰‹å†™å‘å¸ƒ-è®¢é˜…æ¨¡å¼

```typescript
class EventCenter {
    // 1. å®šä¹‰äº‹ä»¶å®¹å™¨ï¼Œç”¨æ¥è£…äº‹ä»¶æ•°ç»„
    let
    handlers = {}

    // 2. æ·»åŠ äº‹ä»¶æ–¹æ³•ï¼Œå‚æ•°ï¼šäº‹ä»¶å äº‹ä»¶æ–¹æ³•
    addEventListener(type, handler) {
        // åˆ›å»ºæ–°æ•°ç»„å®¹å™¨
        if (!this.handlers[type]) {
            this.handlers[type] = []
        }
        // å­˜å…¥äº‹ä»¶
        this.handlers[type].push(handler)
    }

    // 3. è§¦å‘äº‹ä»¶ï¼Œå‚æ•°ï¼šäº‹ä»¶å äº‹ä»¶å‚æ•°
    dispatchEvent(type, params) {
        // è‹¥æ²¡æœ‰æ³¨å†Œè¯¥äº‹ä»¶åˆ™æŠ›å‡ºé”™è¯¯
        if (!this.handlers[type]) {
            return new Error('è¯¥äº‹ä»¶æœªæ³¨å†Œ')
        }
        // è§¦å‘äº‹ä»¶
        this.handlers[type].forEach(handler => {
            handler(...params)
        })
    }

    // 4. äº‹ä»¶ç§»é™¤ï¼Œå‚æ•°ï¼šäº‹ä»¶å è¦åˆ é™¤äº‹ä»¶ï¼Œè‹¥æ— ç¬¬äºŒä¸ªå‚æ•°åˆ™åˆ é™¤è¯¥äº‹ä»¶çš„è®¢é˜…å’Œå‘å¸ƒ
    removeEventListener(type, handler) {
        if (!this.handlers[type]) {
            return new Error('äº‹ä»¶æ— æ•ˆ')
        }
        if (!handler) {
            // ç§»é™¤äº‹ä»¶
            delete this.handlers[type]
        } else {
            const index = this.handlers[type].findIndex(el => el === handler)
            if (index === -1) {
                return new Error('æ— è¯¥ç»‘å®šäº‹ä»¶')
            }
            // ç§»é™¤äº‹ä»¶
            this.handlers[type].splice(index, 1)
            if (this.handlers[type].length === 0) {
                delete this.handlers[type]
            }
        }
    }
}

```

## 22. Object.defineProperty(ç®€æ˜“ç‰ˆ)

```javascript
 //  Vue2çš„å“åº”å¼åŸç†ï¼Œç»“åˆäº†Object.definePropertyçš„æ•°æ®åŠ«æŒï¼Œä»¥åŠå‘å¸ƒè®¢é˜…è€…æ¨¡å¼
 //  Vue2çš„æ•°æ®åŠ«æŒï¼Œå°±æ˜¯é€šè¿‡é€’å½’éå†dataé‡Œçš„æ•°æ®ï¼Œç”¨Object.definePropertyç»™æ¯ä¸€ä¸ªå±æ€§æ·»åŠ getterå’Œsetter,
 //  å¹¶ä¸”æŠŠdataé‡Œçš„å±æ€§æŒ‚è½½åˆ°vueå®ä¾‹ä¸­ï¼Œä¿®æ”¹vueå®ä¾‹ä¸Šçš„å±æ€§æ—¶ï¼Œå°±ä¼šè§¦å‘å¯¹åº”çš„setterå‡½æ•°ï¼Œå‘Depè®¢é˜…å™¨å‘å¸ƒæ›´æ–°æ¶ˆæ¯ï¼Œ
 //  å¯¹åº”çš„Watcherè®¢é˜…è€…ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè°ƒç”¨è‡ªèº«çš„å›è°ƒå‡½æ•°ï¼Œè®©ç¼–è¯‘å™¨å»æ›´æ–°è§†å›¾ã€‚
const obj = {
    name: 'åˆ˜é€',
    age: 20
}
const p = {}
for (let key in obj) {
    Object.defineProperty(p, key, {
        get() {
            console.log(`æœ‰äººè¯»å–pé‡Œçš„${key}å±æ€§`);
            return obj[key]
        },
        set(val) {
            console.log(`æœ‰äººä¿®æ”¹äº†pé‡Œçš„${key}å±æ€§,å€¼ä¸º${val},éœ€è¦å»æ›´æ–°è§†å›¾`);
            obj[key] = val
        }
    })
}
```

## 23. Proxyæ•°æ®åŠ«æŒ(ç®€æ˜“ç‰ˆ)

```javascript
 // Vue3çš„æ•°æ®åŠ«æŒé€šè¿‡Proxyå‡½æ•°å¯¹ä»£ç†å¯¹è±¡çš„å±æ€§è¿›è¡ŒåŠ«æŒï¼Œé€šè¿‡Reflectå¯¹è±¡é‡Œçš„æ–¹æ³•å¯¹ä»£ç†å¯¹è±¡çš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œ
 // Proxyä»£ç†å¯¹è±¡ä¸éœ€è¦éå†ï¼Œé…ç½®é¡¹é‡Œçš„å›è°ƒå‡½æ•°å¯ä»¥é€šè¿‡å‚æ•°æ‹¿åˆ°ä¿®æ”¹å±æ€§çš„é”®å’Œå€¼
 // è¿™é‡Œç”¨åˆ°äº†Reflectå¯¹è±¡é‡Œçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œgetï¼Œsetå’ŒdeletePropertyï¼Œæ–¹æ³•éœ€è¦çš„å‚æ•°ä¸é…ç½®é¡¹ä¸­å›è°ƒå‡½æ•°çš„å‚æ•°ç›¸åŒã€‚
 // Reflecté‡Œçš„æ–¹æ³•ä¸Proxyé‡Œçš„æ–¹æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œåªè¦æ˜¯Proxyå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨Reflectå¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚
const obj = {
    name: 'åˆ˜é€',
    age: 20
}
const p = new Proxy(obj, {
    // è¯»å–å±æ€§çš„æ—¶å€™ä¼šè°ƒç”¨getter
    get(target, propName) {  //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä»£ç†çš„æºå¯¹è±¡,ç­‰åŒäºä¸Šé¢çš„Objå‚æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯»å–çš„é‚£ä¸ªå±æ€§å€¼
        console.log(`æœ‰äººè¯»å–på¯¹è±¡é‡Œçš„${propName}å±æ€§`);
        return Reflect.get(target, propName)
    },
    // æ·»åŠ å’Œä¿®æ”¹å±æ€§çš„æ—¶å€™ä¼šè°ƒç”¨setter
    set(target, propName, value) { //å‚æ•°ç­‰åŒäºgetï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¿®æ”¹åçš„å±æ€§å€¼
        console.log(`æœ‰äººä¿®æ”¹äº†på¯¹è±¡é‡Œçš„${propName}å±æ€§,å€¼ä¸º${value},éœ€è¦å»ä¿®æ”¹è§†å›¾`);
        Reflect.set(target, propName, value)
    },
    // åˆ é™¤å±æ€§æ—¶ï¼Œè°ƒç”¨deleteProperty
    deleteProperty(target, propName) { // å‚æ•°ç­‰åŒäºget
        console.log(`æœ‰äººåˆ é™¤äº†på¯¹è±¡é‡Œçš„${propName}å±æ€§ï¼Œéœ€è¦å»ä¿®æ”¹è§†å›¾`);
        return Reflect.deleteProperty(target, propName)
    }
})
```

## 24. å®ç°è·¯ç”±(ç®€æ˜“ç‰ˆ)

```js
// hashè·¯ç”±
class Route {
    constructor() {
        // è·¯ç”±å­˜å‚¨å¯¹è±¡
        this.routes = {}
        // å½“å‰hash
        this.currentHash = ''
        // ç»‘å®šthisï¼Œé¿å…ç›‘å¬æ—¶thisæŒ‡å‘æ”¹å˜
        this.freshRoute = this.freshRoute.bind(this)
        // ç›‘å¬
        window.addEventListener('load', this.freshRoute, false)
        window.addEventListener('hashchange', this.freshRoute, false)
    }

    // å­˜å‚¨
    storeRoute(path, cb) {
        this.routes[path] = cb || function () {
        }
    }

    // æ›´æ–°
    freshRoute() {
        this.currentHash = location.hash.slice(1) || '/'
        this.routes[this.currentHash]()
    }
}
```

## 25. ä½¿ç”¨ setTimeout å®ç° setInterval

å®ç°æ€è·¯æ˜¯ä½¿ç”¨é€’å½’å‡½æ•°ï¼Œä¸æ–­åœ°å»æ‰§è¡Œ setTimeout ä»è€Œè¾¾åˆ° setInterval çš„æ•ˆæœ

```js
function mySetInterval(fn, timeout) {
// æ§åˆ¶å™¨ï¼Œæ§åˆ¶å®šæ—¶å™¨æ˜¯å¦ç»§ç»­æ‰§è¡Œ
    var timer = {flag: true};

// è®¾ç½®é€’å½’å‡½æ•°ï¼Œæ¨¡æ‹Ÿå®šæ—¶å™¨æ‰§è¡Œã€‚
    function interval() {
        if (timer.flag) {
            fn();
            setTimeout(interval, timeout);
        }
    }

// å¯åŠ¨å®šæ—¶å™¨
    setTimeout(interval, timeout);// è¿”å›æ§åˆ¶å™¨
    return timer;
}
```

## 26. ä½¿ç”¨setIntervalå®ç°setTimeout

```js
function mySetInterval(fn, t) {
    const timer = setInterval(() => {
        clearInterval(timer)
        fn()
    }, t)
}

mySetInterval(() => {
    console.log('hoho');
}, 1000)
```

## 27. å®ç° jsonp

```js
// åŠ¨æ€çš„åŠ è½½jsæ–‡ä»¶
function addScript(src) {
    const script = document.createElement('script');
    script.src = src;
    script.type = "text/javascript";
    document.body.appendChild(script);
}

addScript("http://xxx.xxx.com/xxx.js?callback=handleRes");

// è®¾ç½®ä¸€ä¸ªå…¨å±€çš„callbackå‡½æ•°æ¥æ¥æ”¶å›è°ƒç»“æœ
function handleRes(res) {
    console.log(res);
}

// æ¥å£è¿”å›çš„æ•°æ®æ ¼å¼
handleRes({a: 1, b: 2});

```

## 28. æå–å‡ºurl é‡Œçš„å‚æ•°å¹¶è½¬æˆå¯¹è±¡

```javascript
function getUrlParams(url) {
    let reg = /([^?&=]+)=([^?&=]+)/g
    let obj = {}
    url.replace(reg, function () {
        obj[arguments[1]] = arguments[2]
    })
    // æˆ–è€…
    const search = window.location.search
    search.replace(/([^&=?]+)=([^&]+)/g, (m, $1, $2) => {
        obj[$1] = decodeURIComponent($2)
    })

    return obj
}

let url = 'https://www.junjin.cn?a=1&b=2'
console.log(getUrlParams(url)) // { a: 1, b: 2 }
```

## 29. è¯·å†™è‡³å°‘ä¸‰ç§æ•°ç»„å»é‡çš„æ–¹æ³•ï¼Ÿï¼ˆåŸç”Ÿjsï¼‰

```javascript
//åˆ©ç”¨filter
function unique(arr) {
    return arr.filter(function (item, index, arr) {
        //å½“å‰å…ƒç´ ï¼Œåœ¨åŸå§‹æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•==å½“å‰ç´¢å¼•å€¼ï¼Œå¦åˆ™è¿”å›å½“å‰å…ƒç´ 
        return arr.indexOf(item, 0) === index;
    });
}

var arr = [1, 1, 'true', 'true', true, true, 15, 15, false, false, undefined, undefined, null, null, NaN, NaN, 'NaN', 0, 0, 'a', 'a', {}, {}];
console.log(unique(arr))

//åˆ©ç”¨ES6 Setå»é‡ï¼ˆES6ä¸­æœ€å¸¸ç”¨ï¼‰
function unique(arr) {
    return Array.from(new Set(arr))
}

var arr = [1, 1, 'true', 'true', true, true, 15, 15, false, false, undefined, undefined, null, null, NaN, NaN, 'NaN', 0, 0, 'a', 'a', {}, {}];
console.log(unique(arr))
//[1, "true", true, 15, false, undefined, null, NaN, "NaN", 0, "a", {}, {}]

//åˆ©ç”¨foråµŒå¥—forï¼Œç„¶åspliceå»é‡ï¼ˆES5ä¸­æœ€å¸¸ç”¨ï¼‰
function unique(arr) {
    for (var i = 0; i < arr.length; i++) {
        for (var j = i + 1; j < arr.length; j++) {
            if (arr[i] == arr[j]) {         //ç¬¬ä¸€ä¸ªç­‰åŒäºç¬¬äºŒä¸ªï¼Œspliceæ–¹æ³•åˆ é™¤ç¬¬äºŒä¸ª
                arr.splice(j, 1);
                j--;
            }
        }
    }
    return arr;
}

var arr = [1, 1, 'true', 'true', true, true, 15, 15, false, false, undefined, undefined, null, null, NaN, NaN, 'NaN', 0, 0, 'a', 'a', {}, {}];
console.log(unique(arr))
//[1, "true", 15, false, undefined, NaN, NaN, "NaN", "a", {â€¦}, {â€¦}]     
//NaNå’Œ{}æ²¡æœ‰å»é‡ï¼Œä¸¤ä¸ªnullç›´æ¥æ¶ˆå¤±äº†
```

## ç»“è¯­

> &emsp; ä»Šå¤©çš„é¢è¯•é¢˜çš„åˆ†äº«å°±åˆ°è¿™è¾¹å•¦ï¼Œæ˜å¤©ç»§ç»­ç»™å¤§å®¶åˆ†äº«~

## ä½œè€…

| Coder       | å°çº¢ä¹¦ID  | åˆ›å»ºæ—¶é—´   |
| :---------- | :-------- | :--------- |
| è½å¯çš„å‰ç«¯ğŸ‘£ | 121450513 | 2022.10.29 |

